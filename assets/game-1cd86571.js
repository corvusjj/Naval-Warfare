var be=Object.defineProperty;var Le=(t,e,n)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(Le(t,typeof e!="symbol"?e+"":e,n),n);import"./modulepreload-polyfill-3cfb730f.js";import{G as xe,S as M,s as Ce,c as oe,g as se}from"./battleshipCoordinates-f7ad6856.js";const we={idUsed:[],setId(){this.idUsed.length>2&&(this.idUsed=this.idUsed.slice(2));const t=1e3,e=9999,a=(Math.floor(Math.random()*(e-t+1))+t).toString();return this.idUsed.push(a),a}};function Pe(){return{c:new M(5),b:new M(4),r:new M(3),s:new M(3),d:new M(2)}}class X{constructor(e){p(this,"gameBoard");p(this,"ships");p(this,"name");p(this,"id");this.name=e,this.id=we.setId(),this.gameBoard=new xe,this.ships=Pe()}receiveAttack(e){return this.gameBoard.receiveAttack(e)}attack(e,n){return n.receiveAttack(e)}}class j extends X{constructor(n){super(n);p(this,"enemySquares");p(this,"squaresInDiagonal");p(this,"hitQueue");p(this,"enemyShipLengths");p(this,"focusedTarget");this.enemySquares=Ce(),this.squaresInDiagonal=this.getDiagonalCoordinates(),this.hitQueue=[],this.enemyShipLengths=[5,4,3,3,2],this.focusedTarget=[]}getDiagonalCoordinates(){const n=[];function a(o){return o%2!==0}for(const o of this.enemySquares){const s=o[0],i=o[1];if(a(s)&&a(i)||!a(s)&&!a(i))n.push(o);else continue}return n}handleAttackState({state:n,coordinates:a}){if(n==="hit"&&this.hitQueue.push(...a),n==="sunk"){a.forEach(s=>{const i=this.hitQueue.findIndex(l=>l.toString()===s.toString());i!==-1&&this.hitQueue.splice(i,1)});const o=this.enemyShipLengths.findIndex(s=>s===a.length);this.enemyShipLengths.splice(o,1)}}removeCoordinate(n){const a=this.squaresInDiagonal.findIndex(s=>s.toString()===n.toString());a!==-1&&this.squaresInDiagonal.splice(a,1);const o=this.enemySquares.findIndex(s=>s.toString()===n.toString());this.enemySquares.splice(o,1)}coordInHitQueue(n){return this.hitQueue.some(a=>a.every((o,s)=>a.length===n.length&&o===n[s]))}coordNotAttacked(n){return this.enemySquares.some(a=>a.every((o,s)=>a.length===n.length&&o===n[s]))}getVerticalAndHorizontalTargetStates(n){let a,o;n?(a=["origin-hit"],o=["origin-hit"]):(a=["free"],o=["free"]);function s(r,m){switch(r){case"top":a.unshift(m);break;case"right":o.push(m);break;case"bottom":a.push(m);break;case"left":o.unshift(m);break}}const i=this.focusedTarget,l=this.enemyShipLengths[0],d=["top","right","bottom","left"];let u=1;for(u;u<l;u++){let r=0;for(;r<d.length;){const[m,b]=oe(i,d[r],u);if(m<1||m>10||b<1||b>10){d.splice(r,1);continue}if(!this.coordNotAttacked([m,b])&&!this.coordInHitQueue([m,b])){d.splice(r,1);continue}this.coordInHitQueue([m,b])?s(d[r],"hit"):s(d[r],"free"),r++}}return[a,o]}checkPlacement(n,a){const o=[n,a];if(n.length<this.enemyShipLengths[this.enemyShipLengths.length-1]&&o.splice(0,1),a.length<this.enemyShipLengths[this.enemyShipLengths.length-1]&&o.splice(1,1),o.length===0)return!1;if(o.length===1)return o[0];const s=n.filter(l=>l==="hit").length,i=a.filter(l=>l==="hit").length;return s!==i?s>i?o[0]:o[1]:n.length!==a.length?n.length>a.length?o[0]:o[1]:null}damagedShipTargetPursuit(n,a,o){const s=[n,a];let i=[];o!==null?o===n?i=s[0]:i=s[1]:Math.random()<.5?i=s[0]:i=s[1];let l=0;function d(h){const g=l-h,q=i[g];if(!(g<0))return q==="free"?h:d(h+1)}function u(h){const g=l+h,q=i[g];if(!(g>=i.length))return q==="free"?h:u(h+1)}const r=()=>{l=i.findIndex(Ie=>Ie==="origin-hit");const h=this.focusedTarget;let g="",q=0,L;i===n?L=["top","bottom"]:L=["left","right"];const $=d(1),N=u(1);if($!==void 0&&N!==void 0)Math.random()<.5?(q=$,g=L[0]):(q=N,g=L[1]);else if($!==void 0)q=$,g=L[0];else if(N!==void 0)q=N,g=L[1];else return i===s[0]?i=s[1]:i=s[0],r();return[h,g,q]},m=r();return oe(...m)}damagedTargetFinder(){this.focusedTarget=this.hitQueue[0];const[n,a]=this.getVerticalAndHorizontalTargetStates(!0),o=this.checkPlacement(n,a),s=this.damagedShipTargetPursuit(n,a,o);return this.removeCoordinate(s),s}randomTargetFinder(){const n=this.squaresInDiagonal.length,a=Math.round(Math.random()*(n-1)),o=this.squaresInDiagonal[a];this.focusedTarget=o,this.removeCoordinate(o);const[s,i]=this.getVerticalAndHorizontalTargetStates(!1);return this.checkPlacement(s,i)===!1?this.randomTargetFinder():o}chooseTarget(){let n=[];return this.hitQueue.length>0?n=this.damagedTargetFinder():n=this.randomTargetFinder(),n}}const S=document.querySelector("#music"),ie=S==null?void 0:S.querySelector("#music-icon-on"),re=S==null?void 0:S.querySelector("#music-icon-off"),v=document.querySelector("#sound"),ce=v==null?void 0:v.querySelector("#sound-icon-on"),le=v==null?void 0:v.querySelector("#sound-icon-off"),k=document.querySelector("#wave-sound"),de=k==null?void 0:k.querySelector("#wave-sound-icon-on"),ue=k==null?void 0:k.querySelector("#wave-sound-icon-off"),G=document.querySelector("#background-music"),R=document.querySelector("#waves-audio"),Y=document.querySelector("#activate-audio"),K=document.querySelector("#splash-audio"),W=document.querySelector("#explosion-audio"),B=document.querySelector("#sunk-audio"),Z=document.querySelector("#optimal-audio"),_=document.querySelector("#alert-audio"),Se=document.querySelector("#morse-audio");G.volume=.2;R.volume=.7;Y.volume=.3;K.volume=.2;W.volume=.5;B.volume=.3;Z.volume=.3;_.volume=.2;Se.volume=.3;const y=document.querySelector(".led");let x=!0,A=!0,C=!0;function Q(){const t={musicIsActive:x,soundIsActive:A,wavesIsActive:C};window.localStorage.setItem("bs-audio-states",JSON.stringify(t))}function Oe(){const t=window.localStorage.getItem("bs-audio-states");if(t!==null){const e=JSON.parse(t);e.musicIsActive||ve(),e.soundIsActive||ke(),e.wavesIsActive||qe()}else Q()}function ve(){x=!x,S==null||S.setAttribute("data-active",x.toString()),ie&&re&&(ie.style.display=x?"inline":"none",re.style.display=x?"none":"inline"),x?G.play():G.pause(),Q()}function ke(){A=!A,v==null||v.setAttribute("data-active",A.toString()),ce&&le&&(ce.style.display=A?"inline":"none",le.style.display=A?"none":"inline"),Q()}function qe(){C=!C,k==null||k.setAttribute("data-active",C.toString()),de&&ue&&(de.style.display=C?"inline":"none",ue.style.display=C?"none":"inline"),C?R.play():R.pause(),Q()}function De(){A&&(Y.play(),Y.currentTime=0)}function Ee(t){if(A)switch(t){case"miss":K.play(),K.currentTime=0;break;case"hit":W.play(),W.currentTime=0;break;case"sunk":B.play(),B.currentTime=0;break;case"game-over":B.play(),B.currentTime=0;break}}const z={runOptimal(){y==null||y.classList.add("optimal"),setTimeout(()=>{y==null||y.classList.remove("optimal")},500),A&&(Z.play(),Z.currentTime=0)},runAlert(){y==null||y.classList.add("alert"),setTimeout(()=>{y==null||y.classList.remove("alert")},500),A&&(_.play(),_.currentTime=0)}};function Fe(){G.volume=0,setTimeout(()=>void Se.play(),1200)}S==null||S.addEventListener("click",ve);v==null||v.addEventListener("click",ke);k==null||k.addEventListener("click",qe);function He(){Oe(),x&&G.play(),C&&R.play()}let c;class Me{constructor(e,n){p(this,"vsComputer");p(this,"p1");p(this,"p2");p(this,"attacker");p(this,"defender");this.p1=e,this.p2=n,this.vsComputer=!1,this.attacker=e,this.defender=n}toggleState(){this.attacker===this.p1?(this.attacker=this.p2,this.defender=this.p1):(this.attacker=this.p1,this.defender=this.p2),this.attacker===this.p1?w.toggleBoardInterface(1):w.toggleBoardInterface(0)}attack(e){return this.attacker.attack(e,this.defender)}}function Be(t,e,n){c=new Me(t,e),c.vsComputer=n}function Ge(){c.vsComputer&&c.attacker===c.p2?(z.runAlert(),setTimeout(()=>void w.animateHitByComputer(),200)):z.runOptimal()}function $e(t,e){const n=c.defender.id;w.handleSunkShip(n,t,e)}function Ne(t,e){w.handleGameOver(t,e),Fe()}const ee={attack:()=>{if(c.p2 instanceof j){const t=c.p2.chooseTarget();setTimeout(()=>O.attack(t,!0),1200)}},updateAttackState:t=>{c.p2 instanceof j&&c.p2.handleAttackState(t)}},O={setGameState:(t,e)=>{const n=new X(e[0]);let a;t?a=new j(e[1]):a=new X(e[1]),Be(n,a,t)},playersData:()=>{const t=[c.p1.name,c.p1.id],e=[c.p2.name,c.p2.id];return[t,e]},placeFirstPlayerShip:(t,e,n)=>{const a=c.p1.ships[t];e||a.toggleDirection(),c.p1.gameBoard.placeShip(a,n,t)},placeSecondPlayerShip:(t,e,n)=>{const a=c.p2.ships[t];e||a.toggleDirection(),c.p2.gameBoard.placeShip(a,n,t)},attack(t,e){const n=c.attack(t),a=n.state;if(w.markSquareInterface(t,c.defender.id,a),De(),setTimeout(()=>{Ee(a)},500),e&&ee.updateAttackState(n),a!=="miss"){if(setTimeout(()=>Ge(),300),setTimeout(()=>w.setPanelUiToActive(),600),(a==="sunk"||a==="game-over")&&$e(n.squareKey,n.coordinates),a==="game-over")return Ne(c.attacker.name,c.attacker.id);e&&setTimeout(()=>ee.attack(),700)}else setTimeout(()=>w.setPanelUiToActive(),1200),setTimeout(()=>{Ue()},1200)},getState:()=>c};function Ue(){c.toggleState(),c.vsComputer&&c.attacker===c.p2&&ee.attack()}const w={toggleBoardInterface(t){D.toggleBoardUI(t)},markSquareInterface(t,e,n){D.markSquareUI(t,e,n)},setPanelUiToActive(){D.setBoardPanelToActive()},animateHitByComputer(){D.animateHitByComputer()},handleSunkShip(t,e,n){D.handleSunkShip(t,e,n)},handleGameOver(t,e){D.handleGameOver(t,e)}},I={setGameState(t,e){O.setGameState(t,e)},getPlayersData(){return O.playersData()},placeFirstPlayerShip:(t,e,n)=>{O.placeFirstPlayerShip(t,e,n)},placeSecondPlayerShip:(t,e,n)=>{O.placeSecondPlayerShip(t,e,n)},attack(t,e){O.attack(t,e)},getState(){return O.getState()}};let T;const f=document.querySelector("main"),H=document.querySelector(".gameboard-container"),E=document.querySelector(".boards-panel"),he=document.querySelector(".p1-ships"),pe=document.querySelector(".p2-ships"),me=document.querySelectorAll(".attack-highlight"),J=document.querySelector(".attack-highlight.vertical"),V=document.querySelector(".attack-highlight.horizontal"),te=document.querySelector("#attacking-player"),Ae=document.querySelector("#see-fleet-btn"),Re=document.querySelectorAll(".modal"),Te=document.querySelector("#game-over-modal"),Qe=document.querySelector("#winner-name"),ge=document.querySelector('.fleet-modal[data-player="1"]'),fe=document.querySelector('.fleet-modal[data-player="2"]'),ze=document.querySelector("#settings-modal"),Je=document.querySelector("#settings-btn"),U=document.querySelector("#ui-motion-btn"),Ve=document.querySelector(".miss-icon"),Xe=document.querySelector(".fire-gif");let P,F;function je(){E.innerHTML="",P=se(),F=se(),P.setAttribute("data-index","0"),F.setAttribute("data-index","1"),E.appendChild(P),E.appendChild(F),document.querySelectorAll(".square[data-coord]").forEach(e=>e.addEventListener("click",n=>_e(n,!1)))}function Ye(){const t=window.localStorage.getItem("battleship-players-data");T=JSON.parse(t),T.vsComputer?I.setGameState(!0,T.players):I.setGameState(!1,T.players)}function Ke(){const[t,e]=I.getPlayersData();P.setAttribute("data-player-id",t[1]),P.setAttribute("data-player-name",t[0]),F.setAttribute("data-player-id",e[1]),F.setAttribute("data-player-name",e[0]),D.toggleBoardUI(1),T.vsComputer&&(P.style.pointerEvents="none")}function We(){const t=window.localStorage.getItem("battleship-player-boards");return JSON.parse(t)}function Ze(t){t.forEach(e=>{const n=t.indexOf(e),a=e.shipCoordinates,o=e.ships;Object.keys(o).forEach(i=>{const d=o[i].isVertical,u=a[i][0].join("-");n===0?I.placeFirstPlayerShip(i,d,u):I.placeSecondPlayerShip(i,d,u);let r;n===0?r=document.querySelector(`.p1-deployed-ship[data-ship-key=${i}]`):r=document.querySelector(`.p2-deployed-ship[data-ship-key=${i}]`);const m=r.children[0],b=r.children[1];d?(m.style.display="none",r==null||r.setAttribute("data-vertical","true")):(b.style.display="none",r==null||r.setAttribute("data-vertical","false"));let h;n===0?h=P:h=F,h.appendChild(r);const g=h.querySelector(`[data-coord="${u}"]`),q=g.getBoundingClientRect().left-h.getBoundingClientRect().left,L=g.getBoundingClientRect().top-h.getBoundingClientRect().top;r.style.left=q+"px",r.style.top=L+"px",n===0&&T.vsComputer&&ae(r,!1)})})}function ae(t,e){e&&t.classList.add("sunk"),t.classList.add("show")}function ne(t){t===!0?E.classList.remove("inactive"):E.classList.add("inactive")}function _e(t,e){const n=t.target,o=n.dataset.coord.split("-");I.attack(o.map(s=>parseInt(s)),e),n.style.pointerEvents="none",ne(!1)}function et(t){const e=t.getBoundingClientRect().left-(H==null?void 0:H.getBoundingClientRect().left),n=t.getBoundingClientRect().top-(H==null?void 0:H.getBoundingClientRect().top);me.forEach(o=>o.classList.add("show")),J.style.transform=`translateX(${e+33}px)`,V.style.transform=`translateY(${n+33}px)`;function a(){const o=Math.random()<.5,s=Math.random()<.5;me.forEach(i=>i.classList.remove("show")),o?J.style.transform="translateX(507px)":J.style.transform="translateX(0)",s?V.style.transform="translateY(507px)":V.style.transform="translateX(0)"}setTimeout(a,800)}function tt(t){switch(t){case"miss":{const e=Ve.cloneNode(!0);return e.classList.add("show"),e}case"hit":{const e=Xe.cloneNode(!0);return e.classList.add("show"),e}default:return document.createElement("div")}}function ye(t){te.textContent="";let e=0;const n=t.split("");function a(){e>n.length-1||(te.textContent+=n[e],e+=1,setTimeout(a,70))}a()}function nt(t){const e=I.getPlayersData()[0][1],n=I.getState().attacker.ships,a=Object.keys(n);let o;a.forEach(s=>{n[s].isSunk()||(e===t?o=document.querySelector(`.p1-deployed-ship[data-ship-key=${s}]`):o=document.querySelector(`.p2-deployed-ship[data-ship-key=${s}]`),ae(o,!1))})}function at(t){nt(t);const e=F.cloneNode(!0),n=P.cloneNode(!0);ge.appendChild(n),fe.appendChild(e);const a=ge.querySelector("h3"),o=fe.querySelector("h3");a.textContent=T.players[0]+"'s Fleet",o.textContent=T.players[1]+"'s Fleet"}function ot(){U.dataset.active==="true"?(U.setAttribute("data-active","false"),f==null||f.classList.remove("ship-motion")):(U.setAttribute("data-active","true"),f==null||f.classList.add("ship-motion"))}const D={toggleBoardUI:t=>{function e(){t===0?(ye(T.players[1]+" to attack..."),E.classList.remove("toggle-panel"),pe.style.display="none",he.style.display="flex"):(ye(T.players[0]+" to attack..."),E.classList.add("toggle-panel"),he.style.display="none",pe.style.display="flex")}requestAnimationFrame(e)},markSquareUI:(t,e,n)=>{const[a,o]=t.map(d=>d.toString()),i=document.querySelector(`[data-player-id="${e}"]`).querySelector(`[data-coord="${a}-${o}"]`);requestAnimationFrame(()=>et(i));const l=tt(n);setTimeout(()=>{i.appendChild(l)},600)},setBoardPanelToActive:()=>{ne(!0)},animateHitByComputer:()=>{f!=null&&f.classList.contains("ship-motion")&&(f==null||f.classList.add("ship-hit"),setTimeout(()=>f.classList.remove("ship-hit"),300))},handleSunkShip:(t,e,n)=>{const a=I.getPlayersData()[0][1],o=document.querySelector(`.board[data-player-id="${t}"]`);let s,i;t===a?(s=document.querySelector(`.p1-deployed-ship[data-ship-key=${e}]`),i=document.querySelector(`.p1-ships > [data-ship-key=${e}]`)):(s=document.querySelector(`.p2-deployed-ship[data-ship-key=${e}]`),i=document.querySelector(`.p2-ships > [data-ship-key=${e}]`)),setTimeout(()=>{ae(s,!0),i.classList.add("sunk"),i.classList.add("animate-eliminated")},600),setTimeout(()=>i.classList.remove("animate-eliminated"),1200),setTimeout(()=>{n.forEach(l=>{const d=l.join("-"),u=o.querySelector(`.square[data-coord="${d}"]`);for(;u!=null&&u.firstChild;)u.removeChild(u.firstChild)})},600)},handleGameOver:(t,e)=>{Qe.textContent=t,setTimeout(ne,700,!1),setTimeout(()=>at(e),700),setTimeout(()=>{Te.showModal(),te.style.display="none",Ae.style.display="block"},1500)}};function st(){je(),console.log("hi"),Ye(),Ke();const t=We();Ze(t),He(),Ae.addEventListener("click",()=>Te.showModal()),Je.addEventListener("click",()=>ze.showModal()),U.addEventListener("click",ot),Re.forEach(e=>e.addEventListener("click",n=>{n.target===e&&e.close()}))}st();
