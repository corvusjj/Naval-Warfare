var k=Object.defineProperty;var x=(e,t,a)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var i=(e,t,a)=>(x(e,typeof t!="symbol"?t+"":t,a),a);import"./modulepreload-polyfill-3cfb730f.js";import{S as p,G as C,g as L,c as F,s as G}from"./battleshipCoordinates-f7ad6856.js";function b(){return{c:new p(5),b:new p(4),r:new p(3),s:new p(3),d:new p(2)}}const D=document.querySelectorAll(".ship"),g=document.querySelector(".boards-panel"),B=document.querySelector("#reset-btn"),v=document.querySelector("#random-btn"),l=document.querySelector("#start-btn");class N{constructor(){i(this,"playersData");i(this,"player1Board");i(this,"player2Board");i(this,"currentBoard");i(this,"currentBoardInterface");i(this,"activeFleet");this.playersData=w(),this.player1Board=new C,this.player2Board=new C,this.currentBoard=this.player1Board,this.currentBoardInterface=document.createElement("div"),this.activeFleet=b()}getPlayerData(){const t=localStorage.getItem("battleship-players-data");return JSON.parse(t)}setNameOnHeader(){const t=document.querySelector("#player-name");this.currentBoard===this.player1Board?t.textContent=`${this.playersData.players[0]}'s Fleet`:t.textContent=`${this.playersData.players[1]}'s Fleet`}setStartBtnContent(){this.playersData.vsComputer?l.textContent="Start Game":this.currentBoard===this.player1Board?l.textContent=`${this.playersData.players[1]}'s Fleet`:l.textContent="Start Game"}setStartBtnState(){const t=r.currentBoard.getShipsStatus();Object.keys(t).length===5?l.classList.add("active"):l.classList.remove("active")}setCurrentBoardInterface(){this.currentBoard===this.player1Board?this.currentBoardInterface=document.querySelector('.board[data-index="0"]'):this.currentBoardInterface=document.querySelector('.board[data-index="1"]')}resetFleet(){this.currentBoard.reset(),this.activeFleet=b();for(const t in this.activeFleet)this.activeFleet[t].toggleDirection();this.setStartBtnState()}toggleSecondPlayerBoard(){this.currentBoard=this.player2Board,this.setCurrentBoardInterface(),this.playersData.vsComputer||(g.classList.add("toggle-panel"),this.setNameOnHeader(),this.setStartBtnContent())}startGame(){const t=[r.player1Board,r.player2Board];localStorage.setItem("battleship-player-boards",JSON.stringify(t)),document.querySelector("#start-game-link").click()}initialize(){this.setNameOnHeader(),this.setStartBtnContent(),this.setCurrentBoardInterface(),this.resetFleet()}}const r=new N;let E,y,S;const d=[];function w(){const e=localStorage.getItem("battleship-players-data");return JSON.parse(e)}function V(){g.innerHTML="";const e=L(),t=L();e.setAttribute("data-index","0"),t.setAttribute("data-index","1"),g.appendChild(e),g.appendChild(t),document.querySelectorAll(".square[data-coord]").forEach(n=>{n.addEventListener("dragenter",W),n.addEventListener("dragleave",X),n.addEventListener("dragover",Y),n.addEventListener("drop",Q)})}function M(){this.dataset.vertical==="false"?this.setAttribute("data-vertical","true"):this.setAttribute("data-vertical","false");const e=this.dataset.character;r.activeFleet[e].toggleDirection()}function j(e){const t=e.target,a=t.dataset.length;let n=0;a!==void 0&&(n=parseInt(a));let s,o,c;t.dataset.vertical==="true"?s="top":s="left",t.dataset.vertical==="true"?(o=t.offsetHeight,c=e.offsetY):(o=t.offsetWidth,c=e.offsetX);const h=Math.round(c/o*100);let u=Math.round(n*h/100);u<1&&(u=1);const f=u-1;E={direction:s,span:f}}function H(e){var o;const a=(o=e.target.dataset.coord)==null?void 0:o.split("-").map(c=>parseInt(c)),{direction:n,span:s}=E;return[a,n,s]}function J(e){const t=H(e);return F(t[0],t[1],t[2])}function $(e,t){const a=t.join("-");S=r.currentBoard.seekCoordinates(e,a)}function K(){m(),S.coordinates.forEach(e=>{const t=e.join("-"),n=r.currentBoardInterface.querySelector(`.square[data-coord="${t}"]`);d.push(n)}),S.canBePlaced?d.forEach(e=>e.setAttribute("data-placement","valid")):d.forEach(e=>e.setAttribute("data-placement","invalid"))}function m(){d.forEach(e=>e.removeAttribute("data-placement")),d.length=0}function I(){const e=document.querySelector(".dragging"),t=r.currentBoardInterface,a=d[0];e.classList.remove("ship-default"),t.appendChild(e);const n=a.getBoundingClientRect().left-t.getBoundingClientRect().left,s=a.getBoundingClientRect().top-t.getBoundingClientRect().top;e.style.left=n+"px",e.style.top=s+"px";const o=y,c=a.dataset.coord,h=e.dataset.character;r.currentBoard.placeShip(o,c,h)}function O(){q();const e=[...D],t=G();e.forEach(a=>{Math.random()<.5&&a.click(),a.classList.add("dragging");const s=a.dataset.character,o=r.activeFleet[s];y=o;function c(){const u=Math.floor(Math.random()*t.length),f=t[u];if(!r.currentBoard.seekCoordinates(o,f.join("-")).canBePlaced)return c();const P=f.join("-"),A=r.currentBoardInterface.querySelector(`.square[data-coord="${P}"]`);d.push(A)}c(),I(),r.setStartBtnState(),document.querySelector(".dragging").classList.remove("dragging"),m()})}function q(){r.currentBoard.reset(),r.resetFleet();const e=[...document.querySelectorAll(".ship-container")],t=[...D];e.forEach(a=>{const n=a.id,s=t.find(o=>o.dataset.ship===n);a.appendChild(s),s.style.left="50%",s.style.top="50%",s.dataset.vertical="false",s.classList.add("ship-default")})}function R(){r.playersData.vsComputer?(r.toggleSecondPlayerBoard(),O(),r.startGame()):r.currentBoard===r.player1Board?(r.toggleSecondPlayerBoard(),setTimeout(()=>q(),500)):r.startGame()}function z(e){j(e),this.classList.add("dragging");const t=this.dataset.character;y=r.activeFleet[t]}function T(){this.classList.remove("dragging"),m()}function W(e){const t=J(e);if(t[0]<1||t[1]<1)return m();$(y,t),K()}function X(){}function Y(e){e.preventDefault()}function Q(){S.canBePlaced&&I(),r.setStartBtnState()}function U(){V(),console.log(r.playersData),r.initialize(),D.forEach(e=>{e.addEventListener("click",M),e.addEventListener("dragstart",z),e.addEventListener("dragend",T)}),B==null||B.addEventListener("click",q),v==null||v.addEventListener("click",O),l.addEventListener("click",R)}U();
